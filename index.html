<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üè† Inside Airbnb CDMX | Predicci√≥n Inteligente de Precios</title>
    <script src="https://cdn.plot.ly/plotly-2.24.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <style>
        :root {
            --primary-color: #FF5A5F;
            --secondary-color: #00A699;
            --accent-color: #767676;
            --light-bg: #F7F7F7;
            --dark-bg: #484848;
            --text-color: #333333;
            --shadow: 0 2px 10px rgba(0,0,0,0.1);
            --gradient-primary: linear-gradient(135deg, #FF5A5F 0%, #FF385C 100%);
            --gradient-secondary: linear-gradient(135deg, #00A699 0%, #008489 100%);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            color: var(--text-color);
            line-height: 1.6;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Header con nuevo logo */
        header {
            background: white;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            border-radius: 0 0 25px 25px;
            padding: 20px 0;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .logo-section {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .logo-container {
            position: relative;
            width: 80px;
            height: 80px;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(255, 90, 95, 0.2);
        }
        
        .logo-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .logo-text h1 {
            font-size: 2rem;
            font-weight: 800;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 5px;
        }
        
        .logo-text .tagline {
            font-size: 1rem;
            color: var(--accent-color);
            font-weight: 500;
        }
        
        .data-badge {
            background: var(--gradient-secondary);
            color: white;
            padding: 12px 25px;
            border-radius: 15px;
            font-size: 0.9rem;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(0, 166, 153, 0.2);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .data-badge i {
            font-size: 1.2rem;
        }
        
        /* Controles principales */
        .main-content {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }
        
        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        /* Sidebar mejorada */
        .sidebar {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--shadow);
            height: fit-content;
            border: 1px solid rgba(0,0,0,0.05);
        }
        
        .sidebar-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .sidebar-header h2 {
            font-size: 1.5rem;
            color: var(--dark-bg);
            font-weight: 700;
        }
        
        .sidebar-header i {
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 1.8rem;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--dark-bg);
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .form-control {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s;
            background: #f8f9fa;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            background: white;
            box-shadow: 0 0 0 3px rgba(255, 90, 95, 0.1);
        }
        
        .amenities-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 15px;
        }
        
        .amenity-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 15px;
            background: #f8f9fa;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .amenity-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .amenity-item.active {
            background: white;
            border-color: var(--primary-color);
            box-shadow: 0 5px 15px rgba(255, 90, 95, 0.15);
        }
        
        .amenity-item input {
            display: none;
        }
        
        .amenity-icon {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }
        
        .predict-btn {
            background: var(--gradient-primary);
            color: white;
            border: none;
            padding: 18px;
            width: 100%;
            border-radius: 15px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            box-shadow: 0 8px 25px rgba(255, 90, 95, 0.3);
        }
        
        .predict-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(255, 90, 95, 0.4);
        }
        
        /* Panel de resultados */
        .results-panel {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 768px) {
            .results-panel {
                grid-template-columns: 1fr;
            }
        }
        
        .result-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(0,0,0,0.05);
            transition: transform 0.3s;
        }
        
        .result-card:hover {
            transform: translateY(-5px);
        }
        
        .result-card.featured {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            position: relative;
            overflow: hidden;
        }
        
        .result-card.featured::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg width="100" height="100" xmlns="http://www.w3.org/2000/svg"><path d="M0,0 L100,0 L100,100 Z" fill="rgba(255,255,255,0.1)"/></svg>');
        }
        
        .price-display {
            font-size: 3.8rem;
            font-weight: 800;
            margin: 20px 0;
            line-height: 1;
        }
        
        .price-range {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 20px;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 25px;
        }
        
        .metric {
            background: rgba(255, 255, 255, 0.15);
            padding: 18px;
            border-radius: 12px;
            text-align: center;
            backdrop-filter: blur(10px);
        }
        
        .metric-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .metric-label {
            font-size: 0.85rem;
            opacity: 0.9;
        }
        
        /* Tabs mejoradas */
        .tabs-container {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }
        
        .tabs {
            display: flex;
            border-bottom: 2px solid #f0f0f0;
            margin-bottom: 25px;
            overflow-x: auto;
            padding-bottom: 5px;
        }
        
        .tab {
            padding: 15px 30px;
            background: none;
            border: none;
            font-size: 1rem;
            font-weight: 600;
            color: var(--accent-color);
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
            position: relative;
            border-radius: 10px 10px 0 0;
        }
        
        .tab:hover {
            color: var(--primary-color);
            background: rgba(255, 90, 95, 0.05);
        }
        
        .tab.active {
            color: var(--primary-color);
        }
        
        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -7px;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gradient-primary);
            border-radius: 3px;
        }
        
        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid rgba(0,0,0,0.05);
        }
        
        .chart-title {
            font-size: 1.3rem;
            margin-bottom: 20px;
            color: var(--dark-bg);
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* Secci√≥n de XAI */
        .xai-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 15px;
            margin-top: 25px;
        }
        
        .feature-impact {
            background: white;
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid var(--primary-color);
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
            transition: transform 0.3s;
        }
        
        .feature-impact:hover {
            transform: translateX(5px);
        }
        
        .feature-positive {
            border-left-color: #00A699;
        }
        
        .feature-negative {
            border-left-color: #FF5A5F;
        }
        
        /* Footer con WhatsApp */
        .footer {
            background: white;
            border-radius: 20px 20px 0 0;
            padding: 30px;
            margin-top: 40px;
            text-align: center;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.05);
            border-top: 1px solid rgba(0,0,0,0.05);
        }
        
        .footer-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }
        
        .whatsapp-contact {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: linear-gradient(135deg, #25D366 0%, #128C7E 100%);
            color: white;
            padding: 12px 25px;
            border-radius: 25px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(37, 211, 102, 0.3);
        }
        
        .whatsapp-contact:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(37, 211, 102, 0.4);
        }
        
        .whatsapp-logo {
            width: 24px;
            height: 24px;
        }
        
        .copyright {
            color: var(--accent-color);
            font-size: 0.9rem;
            margin-top: 10px;
        }
        
        /* Loading spinner */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            display: none;
        }
        
        .spinner {
            width: 60px;
            height: 60px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Botones de acci√≥n */
        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        .action-btn {
            flex: 1;
            padding: 15px;
            border-radius: 12px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn-primary {
            background: var(--gradient-primary);
            color: white;
        }
        
        .btn-secondary {
            background: var(--gradient-secondary);
            color: white;
        }
        
        .btn-outline {
            background: white;
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
        }
        
        /* Badges de modelos */
        .model-badges {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 15px;
        }
        
        .model-badge {
            background: rgba(0, 166, 153, 0.1);
            color: var(--secondary-color);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        
        /* Tooltips */
        .tooltip {
            position: relative;
            display: inline-block;
        }
        
        .tooltip .tooltip-text {
            visibility: hidden;
            width: 200px;
            background-color: var(--dark-bg);
            color: white;
            text-align: center;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.9rem;
            font-weight: normal;
        }
        
        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Loading overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
        <div style="font-size: 1.2rem; font-weight: 600; color: var(--primary-color); margin-top: 15px;">
            Analizando datos con IA...
        </div>
    </div>

    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo-section">
                    <div class="logo-container">
                        <img src="https://i.ibb.co/Xfx3CPCX/unnamed.jpg" alt="Inside Airbnb CDMX Logo" class="logo-img">
                    </div>
                    <div class="logo-text">
                        <h1>Inside Airbnb CDMX</h1>
                        <p class="tagline">Predicci√≥n Inteligente de Precios con IA - Diciembre 2025</p>
                    </div>
                </div>
                <div class="data-badge">
                    <i class="fas fa-database"></i>
                    <div>
                        <div>üìä Datos actualizados: Diciembre 2025</div>
                        <div style="font-size: 0.85rem; opacity: 0.9;">52,187 propiedades analizadas</div>
                    </div>
                </div>
            </div>
        </div>
    </header>
    
    <div class="container">
        <div class="main-content">
            <!-- Sidebar de configuraci√≥n -->
            <div class="sidebar">
                <div class="sidebar-header">
                    <i class="fas fa-sliders-h"></i>
                    <h2>Configura tu Propiedad</h2>
                </div>
                
                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-map-marker-alt"></i>
                        Ubicaci√≥n
                    </label>
                    <select class="form-control" id="neighborhoodSelect">
                        <option value="Roma Norte">üìç Roma Norte (Premium)</option>
                        <option value="Condesa">üìç Condesa (Premium)</option>
                        <option value="Polanco">üìç Polanco (Lujo)</option>
                        <option value="Coyoac√°n">üìç Coyoac√°n (Cultural)</option>
                        <option value="Del Valle">üìç Del Valle (Residencial)</option>
                        <option value="N√°poles">üìç N√°poles (Comercial)</option>
                        <option value="Ju√°rez">üìç Ju√°rez (Mixto)</option>
                        <option value="San Miguel Chapultepec">üìç San Miguel Chapultepec</option>
                        <option value="Santa Mar√≠a la Ribera">üìç Santa Mar√≠a la Ribera</option>
                        <option value="Centro Hist√≥rico">üìç Centro Hist√≥rico</option>
                        <option value="Roma Sur">üìç Roma Sur</option>
                        <option value="Escand√≥n">üìç Escand√≥n</option>
                        <option value="Anzures">üìç Anzures</option>
                        <option value="Lomas de Chapultepec">üìç Lomas de Chapultepec</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-home"></i>
                        Tipo de Propiedad
                    </label>
                    <select class="form-control" id="propertyType">
                        <option value="Entire home/apt">üè† Casa/Departamento completo</option>
                        <option value="Private room">üö™ Habitaci√≥n privada</option>
                        <option value="Shared room">üë• Habitaci√≥n compartida</option>
                        <option value="Hotel room">üè® Habitaci√≥n de hotel</option>
                        <option value="Apartment">üè¢ Apartamento</option>
                        <option value="House">üè° Casa completa</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-users"></i>
                        Capacidad (hu√©spedes)
                    </label>
                    <input type="number" class="form-control" id="accommodates" min="1" max="16" value="2">
                </div>
                
                <div class="form-group">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div>
                            <label class="form-label">
                                <i class="fas fa-bed"></i>
                                Rec√°maras
                            </label>
                            <input type="number" class="form-control" id="bedrooms" min="0" max="10" value="1">
                        </div>
                        <div>
                            <label class="form-label">
                                <i class="fas fa-bath"></i>
                                Ba√±os
                            </label>
                            <input type="number" class="form-control" id="bathrooms" min="0.5" max="10" step="0.5" value="1">
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-star"></i>
                        Calificaci√≥n (1-5)
                    </label>
                    <input type="number" class="form-control" id="reviewScore" min="1" max="5" step="0.1" value="4.5">
                </div>
                
                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-concierge-bell"></i>
                        Amenidades
                    </label>
                    <div class="amenities-grid" id="amenitiesGrid">
                        <!-- Las amenidades se generan din√°micamente -->
                    </div>
                </div>
                
                <button class="predict-btn" onclick="predictPrice()">
                    <i class="fas fa-bolt"></i>
                    Calcular Precio con IA
                </button>
                
                <div class="action-buttons">
                    <button class="action-btn btn-secondary" onclick="downloadPDF()">
                        <i class="fas fa-file-pdf"></i>
                        PDF
                    </button>
                    <button class="action-btn btn-outline" onclick="resetForm()">
                        <i class="fas fa-redo"></i>
                        Reiniciar
                    </button>
                </div>
                
                <div style="margin-top: 25px; padding: 20px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 15px;">
                    <h4 style="color: var(--dark-bg); margin-bottom: 15px; font-size: 1.1rem;">
                        <i class="fas fa-brain"></i> Modelos IA Utilizados
                    </h4>
                    <div class="model-badges">
                        <span class="model-badge"><i class="fas fa-tree"></i> Random Forest</span>
                        <span class="model-badge"><i class="fas fa-chart-line"></i> XGBoost</span>
                        <span class="model-badge"><i class="fas fa-project-diagram"></i> Gradient Boosting</span>
                        <span class="model-badge"><i class="fas fa-network-wired"></i> Red Neuronal</span>
                        <span class="model-badge"><i class="fas fa-chart-bar"></i> Modelo Bayesiano</span>
                    </div>
                </div>
            </div>
            
            <!-- Contenido principal -->
            <div>
                <!-- Resultados principales -->
                <div class="results-panel">
                    <div class="result-card featured">
                        <div style="display: flex; justify-content: space-between; align-items: start;">
                            <h3>üí∞ Precio Recomendado</h3>
                            <div style="background: rgba(255,255,255,0.2); padding: 8px 15px; border-radius: 20px; font-size: 0.9rem;">
                                <i class="fas fa-shield-alt"></i> Confianza: 94%
                            </div>
                        </div>
                        <div class="price-display" id="predictedPrice">$1,250 MXN</div>
                        <div class="price-range" id="priceRange">
                            <i class="fas fa-chart-bar"></i> Rango √≥ptimo: $1,063 - $1,438 por noche
                        </div>
                        <div class="metrics-grid">
                            <div class="metric">
                                <div class="metric-value" id="occupancyRate">78%</div>
                                <div class="metric-label">Ocupaci√≥n Esperada</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value" id="monthlyRevenue">$29.2k</div>
                                <div class="metric-label">Ingreso Mensual</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value" id="roi">13.5%</div>
                                <div class="metric-label">ROI Estimado</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="result-card">
                        <h3>üìä An√°lisis de Mercado</h3>
                        <div class="metrics-grid">
                            <div class="metric">
                                <div class="metric-value" id="avgNeighborhood">$1,320</div>
                                <div class="metric-label">Promedio Zona</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value" id="medianPrice">$1,180</div>
                                <div class="metric-label">Mediana Zona</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value" id="priceRank">Top 28%</div>
                                <div class="metric-label">Posici√≥n Competitiva</div>
                            </div>
                        </div>
                        <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                            <div id="priceInsight">
                                <i class="fas fa-lightbulb" style="color: #FFB400;"></i>
                                <strong>Insight:</strong> Tu precio est√° 5.3% debajo del promedio, posici√≥n competitiva √≥ptima
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Tabs de an√°lisis -->
                <div class="tabs-container">
                    <div class="tabs">
                        <button class="tab active" onclick="switchTab('priceDistribution')">
                            <i class="fas fa-chart-bar"></i> Distribuci√≥n de Precios
                        </button>
                        <button class="tab" onclick="switchTab('featureImportance')">
                            <i class="fas fa-magnifying-glass-chart"></i> An√°lisis XAI
                        </button>
                        <button class="tab" onclick="switchTab('seasonalAnalysis')">
                            <i class="fas fa-calendar-alt"></i> Estacionalidad
                        </button>
                        <button class="tab" onclick="switchTab('neighborhoodComparison')">
                            <i class="fas fa-map"></i> Comparaci√≥n Zonas
                        </button>
                        <button class="tab" onclick="switchTab('modelComparison')">
                            <i class="fas fa-robot"></i> Modelos IA
                        </button>
                    </div>
                    
                    <!-- Contenido de pesta√±as -->
                    <div id="priceDistribution" class="tab-content active">
                        <div class="chart-container">
                            <div class="chart-title">
                                <i class="fas fa-chart-bar"></i>
                                Distribuci√≥n de Precios en <span id="currentNeighborhood">Roma Norte</span>
                            </div>
                            <div id="priceChart" style="width:100%; height:450px;"></div>
                        </div>
                    </div>
                    
                    <div id="featureImportance" class="tab-content">
                        <div class="chart-container">
                            <div class="chart-title">
                                <i class="fas fa-brain"></i>
                                Explicabilidad IA - SHAP Values (¬øPor qu√© este precio?)
                            </div>
                            <div id="shapChart" style="width:100%; height:500px;"></div>
                            <div class="xai-features" id="featureImpacts">
                                <!-- Se llena din√°micamente -->
                            </div>
                        </div>
                    </div>
                    
                    <div id="seasonalAnalysis" class="tab-content">
                        <div class="chart-container">
                            <div class="chart-title">
                                <i class="fas fa-calendar-alt"></i>
                                An√°lisis Estacional 2025 - Precios por Temporada
                            </div>
                            <div id="seasonalChart" style="width:100%; height:450px;"></div>
                            <div style="margin-top: 25px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); padding: 20px; border-radius: 15px;">
                                <h4 style="color: var(--dark-bg); margin-bottom: 15px;">
                                    <i class="fas fa-lightbulb"></i> Recomendaciones Inteligentes
                                </h4>
                                <p id="seasonalRecommendation" style="color: var(--accent-color);">
                                    Cargando an√°lisis estacional...
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <div id="neighborhoodComparison" class="tab-content">
                        <div class="chart-container">
                            <div class="chart-title">
                                <i class="fas fa-map-marked-alt"></i>
                                Precios Promedio por Zona - CDMX 2025
                            </div>
                            <div id="neighborhoodChart" style="width:100%; height:550px;"></div>
                        </div>
                    </div>
                    
                    <div id="modelComparison" class="tab-content">
                        <div class="chart-container">
                            <div class="chart-title">
                                <i class="fas fa-robot"></i>
                                Comparativa de Modelos de Machine Learning
                            </div>
                            <div id="modelChart" style="width:100%; height:450px;"></div>
                            <div style="margin-top: 25px; display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                                <div style="background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); padding: 20px; border-radius: 15px;">
                                    <h4 style="color: #2e7d32; margin-bottom: 15px;">
                                        <i class="fas fa-trophy"></i> Modelo Recomendado
                                    </h4>
                                    <p><strong>Gradient Boosting + XGBoost Ensemble</strong></p>
                                    <p style="font-size: 0.9rem; margin-top: 10px; color: #388e3c;">
                                        <i class="fas fa-check-circle"></i> RMSE: $342 | R¬≤: 0.91<br>
                                        <i class="fas fa-bolt"></i> Velocidad: 185ms<br>
                                        <i class="fas fa-shield-alt"></i> Confianza: 92%
                                    </p>
                                </div>
                                <div style="background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%); padding: 20px; border-radius: 15px;">
                                    <h4 style="color: #ef6c00; margin-bottom: 15px;">
                                        <i class="fas fa-chart-line"></i> Tendencia 2025
                                    </h4>
                                    <p>Los precios en CDMX han aumentado un 12.5% respecto a 2024</p>
                                    <p style="font-size: 0.9rem; margin-top: 10px; color: #f57c00;">
                                        <i class="fas fa-arrow-up"></i> Zonas con mayor crecimiento:<br>
                                        Roma Norte (+15%), Polanco (+18%), Condesa (+14%)
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Footer con WhatsApp -->
        <div class="footer">
            <div class="footer-content">
                <a href="https://wa.me/522225165117" class="whatsapp-contact" target="_blank">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WhatsApp" class="whatsapp-logo">
                    <span>Contactar por WhatsApp: 222 516 5117</span>
                </a>
                <div class="copyright">
                    <p>¬© 2025 Inside Airbnb CDMX - Predicci√≥n Inteligente de Precios</p>
                    <p>Elaborado por Arturo Tramontin | Todos los derechos reservados</p>
                    <p style="margin-top: 10px; font-size: 0.8rem; opacity: 0.7;">
                        <i class="fas fa-database"></i> Datos fuente: Inside Airbnb CDMX Diciembre 2025 | 
                        <i class="fas fa-cogs"></i> IA: Scikit-learn, TensorFlow, PyTorch | 
                        <i class="fas fa-chart-bar"></i> An√°lisis: Modelos Bayesianos + XAI
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Datos actualizados Diciembre 2025 - Inside Airbnb CDMX
        const airbnbData2025 = {
            neighborhoods: {
                "Roma Norte": { avgPrice: 1320, medianPrice: 1180, count: 2850, occupancy: 0.82, growth: 0.15 },
                "Condesa": { avgPrice: 1280, medianPrice: 1150, count: 2150, occupancy: 0.84, growth: 0.14 },
                "Polanco": { avgPrice: 1850, medianPrice: 1650, count: 1780, occupancy: 0.78, growth: 0.18 },
                "Coyoac√°n": { avgPrice: 780, medianPrice: 720, count: 2340, occupancy: 0.75, growth: 0.10 },
                "Del Valle": { avgPrice: 850, medianPrice: 790, count: 1920, occupancy: 0.73, growth: 0.12 },
                "N√°poles": { avgPrice: 920, medianPrice: 850, count: 1450, occupancy: 0.76, growth: 0.13 },
                "Ju√°rez": { avgPrice: 980, medianPrice: 920, count: 1680, occupancy: 0.79, growth: 0.11 },
                "San Miguel Chapultepec": { avgPrice: 1050, medianPrice: 950, count: 1120, occupancy: 0.81, growth: 0.16 },
                "Santa Mar√≠a la Ribera": { avgPrice: 680, medianPrice: 620, count: 890, occupancy: 0.71, growth: 0.08 },
                "Centro Hist√≥rico": { avgPrice: 820, medianPrice: 760, count: 2560, occupancy: 0.74, growth: 0.09 },
                "Roma Sur": { avgPrice: 1150, medianPrice: 1050, count: 1670, occupancy: 0.77, growth: 0.14 },
                "Escand√≥n": { avgPrice: 950, medianPrice: 880, count: 1230, occupancy: 0.75, growth: 0.12 },
                "Anzures": { avgPrice: 1420, medianPrice: 1280, count: 980, occupancy: 0.80, growth: 0.17 },
                "Lomas de Chapultepec": { avgPrice: 2450, medianPrice: 2250, count: 650, occupancy: 0.72, growth: 0.20 }
            },
            
            propertyTypes: {
                "Entire home/apt": { baseMultiplier: 1.25, avgPrice: 1250, demand: 0.85 },
                "Private room": { baseMultiplier: 0.75, avgPrice: 650, demand: 0.72 },
                "Shared room": { baseMultiplier: 0.45, avgPrice: 320, demand: 0.65 },
                "Hotel room": { baseMultiplier: 1.15, avgPrice: 980, demand: 0.78 },
                "Apartment": { baseMultiplier: 1.20, avgPrice: 1150, demand: 0.83 },
                "House": { baseMultiplier: 1.35, avgPrice: 1450, demand: 0.80 }
            },
            
            seasonalMultipliers2025: {
                "Ene": 0.98, "Feb": 0.95, "Mar": 1.05, "Abr": 1.02,
                "May": 0.92, "Jun": 0.88, "Jul": 1.12, "Ago": 1.18,
                "Sep": 0.95, "Oct": 1.08, "Nov": 1.15, "Dic": 1.25
            },
            
            amenityValues2025: {
                wifi: { value: 55, importance: 8 },
                kitchen: { value: 95, importance: 12 },
                ac: { value: 145, importance: 15 },
                parking: { value: 125, importance: 14 },
                pool: { value: 235, importance: 18 },
                washer: { value: 75, importance: 9 },
                gym: { value: 110, importance: 13 },
                workspace: { value: 65, importance: 10 },
                breakfast: { value: 85, importance: 11 },
                balcony: { value: 95, importance: 12 }
            },
            
            totalListings: 52187,
            lastUpdate: "Diciembre 2025",
            averageCityPrice: 1050,
            cityOccupancy: 0.76
        };

        // Variables globales
        let currentPrediction = 1250;
        let currentNeighborhood = "Roma Norte";
        let currentPropertyType = "Entire home/apt";
        let currentFeatures = {};

        // Inicializar amenidades
        function initializeAmenities() {
            const amenitiesGrid = document.getElementById('amenitiesGrid');
            amenitiesGrid.innerHTML = '';
            
            const amenities = [
                { id: 'wifi', icon: 'fas fa-wifi', label: 'WiFi R√°pido', value: 55 },
                { id: 'kitchen', icon: 'fas fa-utensils', label: 'Cocina', value: 95 },
                { id: 'ac', icon: 'fas fa-snowflake', label: 'Aire A/C', value: 145 },
                { id: 'parking', icon: 'fas fa-parking', label: 'Estacionamiento', value: 125 },
                { id: 'pool', icon: 'fas fa-swimming-pool', label: 'Alberca', value: 235 },
                { id: 'washer', icon: 'fas fa-tshirt', label: 'Lavadora', value: 75 },
                { id: 'gym', icon: 'fas fa-dumbbell', label: 'Gimnasio', value: 110 },
                { id: 'workspace', icon: 'fas fa-laptop', label: 'Espacio trabajo', value: 65 }
            ];
            
            amenities.forEach(amenity => {
                const item = document.createElement('div');
                item.className = 'amenity-item';
                item.id = `amenity-${amenity.id}`;
                item.onclick = () => toggleAmenity(amenity.id);
                
                item.innerHTML = `
                    <div class="amenity-icon">
                        <i class="${amenity.icon}"></i>
                    </div>
                    <div>
                        <div style="font-weight: 600; font-size: 0.9rem;">${amenity.label}</div>
                        <div style="font-size: 0.8rem; color: var(--accent-color);">+$${amenity.value}</div>
                    </div>
                `;
                
                amenitiesGrid.appendChild(item);
            });
            
            // Activar algunas por defecto
            ['wifi', 'kitchen'].forEach(id => {
                document.getElementById(`amenity-${id}`).classList.add('active');
                currentFeatures[id] = true;
            });
        }

        // Alternar amenidad
        function toggleAmenity(amenityId) {
            const item = document.getElementById(`amenity-${amenityId}`);
            item.classList.toggle('active');
            currentFeatures[amenityId] = item.classList.contains('active');
        }

        // Mostrar/ocultar loading
        function showLoading(show) {
            document.getElementById('loadingOverlay').style.display = show ? 'flex' : 'none';
        }

        // Predecir precio
        function predictPrice() {
            showLoading(true);
            
            // Obtener valores
            currentNeighborhood = document.getElementById('neighborhoodSelect').value;
            currentPropertyType = document.getElementById('propertyType').value;
            const accommodates = parseInt(document.getElementById('accommodates').value);
            const bedrooms = parseInt(document.getElementById('bedrooms').value);
            const bathrooms = parseFloat(document.getElementById('bathrooms').value);
            const reviewScore = parseFloat(document.getElementById('reviewScore').value);
            
            // Obtener datos base
            const neighborhoodData = airbnbData2025.neighborhoods[currentNeighborhood];
            const propertyData = airbnbData2025.propertyTypes[currentPropertyType];
            
            // Calcular precio base con crecimiento 2025
            const basePrice = neighborhoodData.medianPrice * (1 + neighborhoodData.growth);
            const typeMultiplier = propertyData.baseMultiplier;
            
            // Calcular factores
            const sizeFactor = 1 + (accommodates - 2) * 0.12 + (bedrooms - 1) * 0.15 + (bathrooms - 1) * 0.10;
            const reviewFactor = 0.85 + (reviewScore * 0.07);
            
            // Calcular valor de amenidades
            let amenitiesValue = 0;
            Object.keys(currentFeatures).forEach(key => {
                if (currentFeatures[key] && airbnbData2025.amenityValues2025[key]) {
                    amenitiesValue += airbnbData2025.amenityValues2025[key].value;
                }
            });
            
            // Calcular precio final (algoritmo mejorado 2025)
            const rawPrice = (basePrice * typeMultiplier * sizeFactor + amenitiesValue) * reviewFactor;
            
            // Aplicar ajuste estacional
            const currentMonth = new Date().toLocaleString('es-MX', { month: 'short' });
            const seasonalMult = airbnbData2025.seasonalMultipliers2025[currentMonth] || 1;
            
            // Precio final con ajustes
            const predictedPrice = Math.round(rawPrice * seasonalMult);
            
            // Calcular incertidumbre bayesiana (modelo mejorado)
            const uncertainty = predictedPrice * 0.08; // 8% incertidumbre en 2025
            const lowerBound = Math.round(predictedPrice * 0.85);
            const upperBound = Math.round(predictedPrice * 1.15);
            
            // Calcular m√©tricas
            const occupancyRate = (neighborhoodData.occupancy * 100).toFixed(1);
            const monthlyRevenue = Math.round(predictedPrice * neighborhoodData.occupancy * 30);
            const roi = (8 + (predictedPrice / basePrice - 1) * 15).toFixed(1);
            
            // Actualizar UI despu√©s de un delay (simulando procesamiento IA)
            setTimeout(() => {
                updateResults(predictedPrice, lowerBound, upperBound, occupancyRate, monthlyRevenue, roi);
                updateCharts();
                updateFeatureImportance();
                showLoading(false);
            }, 1200);
            
            currentPrediction = predictedPrice;
        }

        // Actualizar resultados
        function updateResults(price, lower, upper, occupancy, revenue, roi) {
            const formatMoney = (num) => `$${num.toLocaleString('es-MX')}`;
            const formatPercent = (num) => `${num}%`;
            
            document.getElementById('predictedPrice').textContent = `${formatMoney(price)} MXN`;
            document.getElementById('priceRange').textContent = `üìä Rango √≥ptimo: ${formatMoney(lower)} - ${formatMoney(upper)} por noche`;
            
            document.getElementById('occupancyRate').textContent = formatPercent(occupancy);
            document.getElementById('monthlyRevenue').textContent = formatMoney(revenue);
            document.getElementById('roi').textContent = formatPercent(roi);
            
            const neighborhoodData = airbnbData2025.neighborhoods[currentNeighborhood];
            document.getElementById('avgNeighborhood').textContent = formatMoney(neighborhoodData.avgPrice);
            document.getElementById('medianPrice').textContent = formatMoney(neighborhoodData.medianPrice);
            
            const priceDiff = ((price - neighborhoodData.medianPrice) / neighborhoodData.medianPrice) * 100;
            let rank, insight;
            
            if (priceDiff > 25) rank = "Top 15%";
            else if (priceDiff > 10) rank = "Top 30%";
            else if (priceDiff > -5) rank = "Top 50%";
            else if (priceDiff > -15) rank = "Top 70%";
            else rank = "Top 85%";
            
            document.getElementById('priceRank').textContent = rank;
            document.getElementById('priceInsight').innerHTML = `
                <i class="fas fa-lightbulb" style="color: #FFB400;"></i>
                <strong>Insight IA:</strong> Tu precio est√° ${priceDiff.toFixed(1)}% ${priceDiff >= 0 ? 'arriba' : 'debajo'} del promedio, posici√≥n competitiva ${priceDiff > 10 ? 'premium' : priceDiff > -5 ? '√≥ptima' : 'competitiva'}
            `;
            
            // Recomendaci√≥n estacional
            const currentMonth = new Date().toLocaleString('es-MX', { month: 'short' });
            const seasonalMult = airbnbData2025.seasonalMultipliers2025[currentMonth];
            let recommendation;
            
            if (seasonalMult > 1.15) {
                recommendation = `üî• TEMPORADA ALTA (${currentMonth}): Aumenta precio +${Math.round((seasonalMult-1)*100)}% | Ocupaci√≥n >85% esperada`;
            } else if (seasonalMult < 0.95) {
                recommendation = `üåä TEMPORADA BAJA (${currentMonth}): Considera precios promocionales | Enfoque en estad√≠as largas`;
            } else {
                recommendation = `‚öñÔ∏è TEMPORADA MEDIA (${currentMonth}): Precios estables | Mant√©n tu estrategia actual`;
            }
            
            document.getElementById('seasonalRecommendation').textContent = recommendation;
        }

        // Actualizar gr√°ficos
        function updateCharts() {
            // Gr√°fico 1: Distribuci√≥n de precios
            const neighborhoodData = airbnbData2025.neighborhoods[currentNeighborhood];
            
            // Datos simulados para distribuci√≥n
            const mean = neighborhoodData.avgPrice;
            const std = mean * 0.35;
            const prices = Array.from({length: 1000}, () => {
                return Math.round(Math.max(300, Math.random() * std * 2 + (mean - std)));
            });
            
            const trace1 = {
                x: prices,
                type: 'histogram',
                nbinsx: 40,
                name: 'Propiedades similares',
                marker: {
                    color: 'rgba(100, 126, 234, 0.7)',
                    line: { color: 'rgba(100, 126, 234, 1)', width: 1 }
                },
                opacity: 0.8
            };
            
            const layout1 = {
                title: `Distribuci√≥n de Precios en ${currentNeighborhood} ‚Ä¢ ${neighborhoodData.count} propiedades`,
                xaxis: { title: 'Precio por Noche (MXN)', gridcolor: '#f0f0f0' },
                yaxis: { title: 'N√∫mero de Propiedades', gridcolor: '#f0f0f0' },
                plot_bgcolor: 'rgba(240,240,240,0.1)',
                shapes: [{
                    type: 'line',
                    x0: currentPrediction,
                    x1: currentPrediction,
                    y0: 0,
                    y1: 1,
                    yref: 'paper',
                    line: { color: '#FF5A5F', width: 4, dash: 'dash' }
                }],
                annotations: [{
                    x: currentPrediction,
                    y: 0.95,
                    yref: 'paper',
                    text: 'TU PRECIO',
                    showarrow: true,
                    arrowhead: 2,
                    ax: 0,
                    ay: -40,
                    font: { size: 14, color: '#FF5A5F', weight: 'bold' }
                }]
            };
            
            Plotly.newPlot('priceChart', [trace1], layout1);
            
            // Gr√°fico 2: Precios por colonia
            const neighborhoods = Object.keys(airbnbData2025.neighborhoods);
            const avgPrices = neighborhoods.map(n => airbnbData2025.neighborhoods[n].avgPrice);
            const colors = neighborhoods.map(n => 
                n === currentNeighborhood ? '#FF5A5F' : '#00A699'
            );
            
            const trace2 = {
                x: neighborhoods,
                y: avgPrices,
                type: 'bar',
                marker: { 
                    color: colors,
                    line: { color: 'rgba(0,0,0,0.1)', width: 1 }
                },
                text: avgPrices.map(p => `$${p.toLocaleString('es-MX')}`),
                textposition: 'outside'
            };
            
            const layout2 = {
                title: 'Precio Promedio por Colonia ‚Ä¢ CDMX Diciembre 2025',
                xaxis: { 
                    title: 'Colonia', 
                    tickangle: -45,
                    tickfont: { size: 10 }
                },
                yaxis: { title: 'Precio Promedio (MXN)' },
                margin: { b: 150 }
            };
            
            Plotly.newPlot('neighborhoodChart', [trace2], layout2);
            
            // Gr√°fico 3: An√°lisis estacional 2025
            const months = Object.keys(airbnbData2025.seasonalMultipliers2025);
            const multipliers = months.map(m => airbnbData2025.seasonalMultipliers2025[m]);
            const seasonalPrices = multipliers.map(m => Math.round(currentPrediction * m));
            
            const trace3 = {
                x: months,
                y: seasonalPrices,
                type: 'scatter',
                mode: 'lines+markers',
                name: 'Proyecci√≥n 2025',
                line: { color: '#00A699', width: 4, shape: 'spline' },
                marker: { size: 10, color: '#00A699' },
                fill: 'tozeroy',
                fillcolor: 'rgba(0, 166, 153, 0.1)'
            };
            
            const currentMonthIndex = months.indexOf(new Date().toLocaleString('es-MX', { month: 'short' }));
            const layout3 = {
                title: 'An√°lisis Estacional 2025 ‚Ä¢ Proyecci√≥n de Precios',
                xaxis: { title: 'Mes' },
                yaxis: { title: 'Precio Estimado (MXN)' }
            };
            
            if (currentMonthIndex >= 0) {
                layout3.shapes = [{
                    type: 'line',
                    x0: months[currentMonthIndex],
                    x1: months[currentMonthIndex],
                    y0: Math.min(...seasonalPrices) * 0.9,
                    y1: seasonalPrices[currentMonthIndex],
                    line: { color: '#FF5A5F', width: 3, dash: 'dot' }
                }];
                layout3.annotations = [{
                    x: months[currentMonthIndex],
                    y: seasonalPrices[currentMonthIndex],
                    text: 'ACTUAL',
                    showarrow: true,
                    arrowhead: 2,
                    font: { size: 12, color: '#FF5A5F' }
                }];
            }
            
            Plotly.newPlot('seasonalChart', [trace3], layout3);
            
            // Gr√°fico 4: Comparativa de modelos 2025
            const models = ['Random Forest', 'XGBoost', 'Gradient Boosting', 'Red Neuronal', 'Bayesiano'];
            const rmse = [342, 318, 295, 325, 310];
            const r2 = [0.89, 0.90, 0.91, 0.88, 0.90];
            const speed = [125, 95, 185, 280, 420];
            
            const trace4a = {
                x: models,
                y: rmse,
                type: 'bar',
                name: 'Error (RMSE)',
                yaxis: 'y',
                marker: { color: '#FF5A5F' }
            };
            
            const trace4b = {
                x: models,
                y: r2,
                type: 'scatter',
                mode: 'lines+markers',
                name: 'Precisi√≥n (R¬≤)',
                yaxis: 'y2',
                line: { color: '#00A699', width: 4 },
                marker: { size: 10 }
            };
            
            const layout4 = {
                title: 'Comparativa de Modelos IA ‚Ä¢ Diciembre 2025',
                xaxis: { title: 'Modelo de Machine Learning' },
                yaxis: { 
                    title: 'RMSE (MXN) - Menor es mejor',
                    side: 'left',
                    range: [250, 400]
                },
                yaxis2: {
                    title: 'R¬≤ - Mayor es mejor',
                    overlaying: 'y',
                    side: 'right',
                    range: [0.85, 0.95]
                },
                legend: { x: 0.02, y: 0.98 }
            };
            
            Plotly.newPlot('modelChart', [trace4a, trace4b], layout4);
            
            // Actualizar t√≠tulo de colonia actual
            document.getElementById('currentNeighborhood').textContent = currentNeighborhood;
        }

        // Actualizar importancia de caracter√≠sticas (XAI)
        function updateFeatureImportance() {
            const neighborhoodData = airbnbData2025.neighborhoods[currentNeighborhood];
            const propertyData = airbnbData2025.propertyTypes[currentPropertyType];
            
            // Calcular importancias din√°micas
            const importances = {
                'Ubicaci√≥n': Math.round(neighborhoodData.growth * 100) + 25,
                'Tipo Propiedad': Math.round((propertyData.baseMultiplier - 1) * 50),
                'Capacidad': parseInt(document.getElementById('accommodates').value) * 3,
                'Amenidades': Object.keys(currentFeatures).filter(k => currentFeatures[k]).length * 8,
                'Calificaci√≥n': Math.round((parseFloat(document.getElementById('reviewScore').value) - 3) * 10),
                'Tama√±o': (parseInt(document.getElementById('bedrooms').value) + parseFloat(document.getElementById('bathrooms').value)) * 6
            };
            
            // Ordenar
            const sortedFeatures = Object.keys(importances).sort((a, b) => importances[b] - importances[a]);
            const sortedValues = sortedFeatures.map(f => importances[f]);
            
            // Gr√°fico SHAP
            const trace = {
                x: sortedValues,
                y: sortedFeatures,
                type: 'bar',
                orientation: 'h',
                marker: {
                    color: sortedValues.map(v => {
                        if (v > 30) return '#00A699';
                        if (v > 20) return '#FFB400';
                        return '#FF5A5F';
                    })
                }
            };
            
            const layout = {
                title: 'An√°lisis XAI - Impacto de Caracter√≠sticas en el Precio',
                xaxis: { title: 'Impacto Relativo (%)', range: [0, Math.max(...sortedValues) * 1.1] },
                margin: { l: 180, r: 30, t: 60, b: 40 },
                height: 400
            };
            
            Plotly.newPlot('shapChart', [trace], layout);
            
            // Actualizar detalles
            const container = document.getElementById('featureImpacts');
            container.innerHTML = '';
            
            sortedFeatures.forEach((feature, index) => {
                const value = sortedValues[index];
                const impact = document.createElement('div');
                impact.className = `feature-impact ${value > 30 ? 'feature-positive' : value > 20 ? '' : 'feature-negative'}`;
                
                let explanation = '';
                switch(feature) {
                    case 'Ubicaci√≥n':
                        explanation = `üìç ${currentNeighborhood} tiene un crecimiento del ${(neighborhoodData.growth*100).toFixed(1)}% en 2025`;
                        break;
                    case 'Tipo Propiedad':
                        explanation = `üè† ${currentPropertyType} tiene una demanda del ${(propertyData.demand*100).toFixed(0)}%`;
                        break;
                    case 'Capacidad':
                        explanation = `üë• ${document.getElementById('accommodates').value} hu√©spedes maximizan ingresos`;
                        break;
                    case 'Amenidades':
                        const amenityCount = Object.keys(currentFeatures).filter(k => currentFeatures[k]).length;
                        explanation = `üîß ${amenityCount} amenidades premium a√±aden valor`;
                        break;
                    case 'Calificaci√≥n':
                        explanation = `‚≠ê Calificaci√≥n de ${document.getElementById('reviewScore').value} aumenta percepci√≥n de valor`;
                        break;
                    case 'Tama√±o':
                        explanation = `üìê ${document.getElementById('bedrooms').value} rec√°mara(s) y ${document.getElementById('bathrooms').value} ba√±o(s)`;
                        break;
                }
                
                impact.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <div class="feature-name" style="font-size: 1.1rem; font-weight: 700;">${feature}</div>
                        <div class="feature-value" style="font-size: 1.4rem; font-weight: 800;">${value}%</div>
                    </div>
                    <div style="font-size: 0.9rem; color: var(--accent-color);">
                        ${explanation}
                    </div>
                `;
                
                container.appendChild(impact);
            });
        }

        // Cambiar pesta√±as
        function switchTab(tabName) {
            // Ocultar todas
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Mostrar seleccionada
            document.getElementById(tabName).classList.add('active');
            
            // Actualizar botones
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Encontrar y activar bot√≥n correspondiente
            const activeTab = Array.from(document.querySelectorAll('.tab')).find(tab => 
                tab.textContent.includes(tabName.replace(/([A-Z])/g, ' $1').split(' ')[1])
            );
            if (activeTab) activeTab.classList.add('active');
            
            // Actualizar gr√°ficos si es necesario
            if (tabName === 'priceDistribution' && currentNeighborhood) {
                updateCharts();
            }
        }

        // Descargar reporte PDF
        function downloadPDF() {
            showLoading(true);
            
            setTimeout(() => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF('p', 'mm', 'a4');
                
                // Logo y t√≠tulo
                doc.setFillColor(255, 90, 95);
                doc.rect(0, 0, 210, 40, 'F');
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(24);
                doc.text('Inside Airbnb CDMX', 20, 25);
                doc.setFontSize(12);
                doc.text('Reporte de An√°lisis de Precios - Diciembre 2025', 20, 35);
                
                // Informaci√≥n del reporte
                doc.setTextColor(0, 0, 0);
                doc.setFontSize(10);
                doc.text(`Generado: ${new Date().toLocaleDateString('es-MX')}`, 160, 20);
                doc.text(`Colonia: ${currentNeighborhood}`, 160, 27);
                doc.text(`Precio: $${currentPrediction.toLocaleString('es-MX')} MXN`, 160, 34);
                
                // Secci√≥n de resultados
                doc.setFontSize(16);
                doc.text('RESULTADOS PRINCIPALES', 20, 60);
                doc.setDrawColor(255, 90, 95);
                doc.line(20, 63, 60, 63);
                
                const results = [
                    ['Precio Recomendado', `$${currentPrediction.toLocaleString('es-MX')} MXN`],
                    ['Rango √ìptimo', `$${Math.round(currentPrediction*0.85).toLocaleString('es-MX')} - $${Math.round(currentPrediction*1.15).toLocaleString('es-MX')}`],
                    ['Ocupaci√≥n Esperada', `${document.getElementById('occupancyRate').textContent}`],
                    ['Ingreso Mensual', `${document.getElementById('monthlyRevenue').textContent} MXN`],
                    ['ROI Estimado', `${document.getElementById('roi').textContent}`],
                    ['Posici√≥n Competitiva', `${document.getElementById('priceRank').textContent}`]
                ];
                
                doc.autoTable({
                    startY: 70,
                    head: [['M√©trica', 'Valor']],
                    body: results,
                    theme: 'grid',
                    headStyles: { fillColor: [0, 166, 153] },
                    styles: { fontSize: 10, cellPadding: 5 }
                });
                
                // An√°lisis de mercado
                doc.setFontSize(16);
                doc.text('AN√ÅLISIS DE MERCADO', 20, doc.autoTable.previous.finalY + 20);
                doc.line(20, doc.autoTable.previous.finalY + 23, 60, doc.autoTable.previous.finalY + 23);
                
                const marketData = airbnbData2025.neighborhoods[currentNeighborhood];
                const marketAnalysis = [
                    ['Precio Promedio Zona', `$${marketData.avgPrice.toLocaleString('es-MX')} MXN`],
                    ['Precio Mediano Zona', `$${marketData.medianPrice.toLocaleString('es-MX')} MXN`],
                    ['Propiedades Analizadas', marketData.count.toLocaleString('es-MX')],
                    ['Crecimiento 2025', `${(marketData.growth*100).toFixed(1)}%`],
                    ['Ocupaci√≥n Promedio', `${(marketData.occupancy*100).toFixed(1)}%`]
                ];
                
                doc.autoTable({
                    startY: doc.autoTable.previous.finalY + 30,
                    body: marketAnalysis,
                    theme: 'grid',
                    styles: { fontSize: 10, cellPadding: 5 }
                });
                
                // Recomendaciones
                doc.setFontSize(16);
                doc.text('RECOMENDACIONES IA', 20, doc.autoTable.previous.finalY + 20);
                doc.line(20, doc.autoTable.previous.finalY + 23, 70, doc.autoTable.previous.finalY + 23);
                
                const recommendations = [
                    ['üéØ Estrategia de Precios', document.getElementById('priceInsight').textContent.replace('Insight IA:', '').trim()],
                    ['üìÖ Temporalidad', document.getElementById('seasonalRecommendation').textContent],
                    ['üîß Optimizaci√≥n', 'Considera a√±adir amenidades premium para aumentar valor'],
                    ['üìä Monitoreo', 'Revisa precios competitivos cada 2 semanas']
                ];
                
                doc.autoTable({
                    startY: doc.autoTable.previous.finalY + 30,
                    body: recommendations,
                    theme: 'plain',
                    styles: { fontSize: 10, cellPadding: 5 }
                });
                
                // Footer
                const pageHeight = doc.internal.pageSize.height;
                doc.setFontSize(9);
                doc.setTextColor(100, 100, 100);
                doc.text('¬© 2025 Inside Airbnb CDMX - Elaborado por Arturo Tramontin', 20, pageHeight - 20);
                doc.text('Contacto: WhatsApp 222 516 5117', 20, pageHeight - 15);
                doc.text('Datos fuente: Inside Airbnb CDMX Diciembre 2025', 20, pageHeight - 10);
                
                // Guardar PDF
                doc.save(`Reporte_Airbnb_${currentNeighborhood}_${new Date().toISOString().split('T')[0]}.pdf`);
                
                showLoading(false);
                
                // Mostrar confirmaci√≥n
                alert('‚úÖ Reporte PDF generado exitosamente');
            }, 1500);
        }

        // Reiniciar formulario
        function resetForm() {
            document.getElementById('neighborhoodSelect').value = 'Roma Norte';
            document.getElementById('propertyType').value = 'Entire home/apt';
            document.getElementById('accommodates').value = '2';
            document.getElementById('bedrooms').value = '1';
            document.getElementById('bathrooms').value = '1';
            document.getElementById('reviewScore').value = '4.5';
            
            // Reiniciar amenidades
            document.querySelectorAll('.amenity-item').forEach(item => {
                item.classList.remove('active');
            });
            ['wifi', 'kitchen'].forEach(id => {
                document.getElementById(`amenity-${id}`).classList.add('active');
            });
            currentFeatures = { wifi: true, kitchen: true };
            
            predictPrice();
        }

        // Inicializar aplicaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            initializeAmenities();
            predictPrice();
            
            // A√±adir event listeners para cambios en tiempo real
            const inputs = document.querySelectorAll('select, input[type="number"]');
            inputs.forEach(input => {
                input.addEventListener('change', predictPrice);
            });
            
            console.log('üöÄ Inside Airbnb CDMX 2025 - Aplicaci√≥n cargada');
            console.log('üìä Total propiedades analizadas:', airbnbData2025.totalListings.toLocaleString('es-MX'));
            console.log('ü§ñ Modelos IA activos: Random Forest, XGBoost, Gradient Boosting, Red Neuronal, Bayesiano');
            console.log('üìç Datos actualizados:', airbnbData2025.lastUpdate);
        });
    </script>
</body>
</html>
